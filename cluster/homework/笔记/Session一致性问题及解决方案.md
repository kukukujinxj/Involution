------



# Session一致性问题及解决方案

## 1 Session共享问题

### 1.1 Session问题原因分析

- Http协议是⽆状态的协议，客户端和服务端在某次会话中产⽣的数据不会被保留下来。早期都是静态⻚⾯⽆所谓有⽆状态，后来有动态的内容更丰富，就需要有状态，出现了两种⽤于保持Http状态的技术，那就是Cookie和Session

### 1.2 解决Session⼀致性的⽅案

- Nginx的IP_Hash策略（可以使⽤）：同⼀个客户端IP的请求都会被路由到同⼀个⽬标服务器，也叫做会话粘滞

    - 优点：
    
        - 配置简单，不⼊侵应⽤，不需要额外修改代码
    
    - 缺点：
    
        - 服务器重启Session丢失
        
        - 存在单点负载⾼的⻛险
        
        - 单点故障问题

- Session复制（不推荐）：多个tomcat之间通过修改配置⽂件，达到Session之间的复制

    - 优点：
    
        - 不⼊侵应⽤
        
        - 便于服务器⽔平扩展
          
        - 能适应各种负载均衡策略
          
        - 服务器重启或者宕机不会造成Session丢失
    
    - 缺点：
    
        - 性能低
        
        - 内存消耗
          
        - 不能存储太多数据，否则数据越多越影响性能
          
        - 延迟性

- Session共享，Session集中存储（推荐）：将Session存储交给Redis

    - 优点：
    
        - 能适应各种负载均衡策略
        
        - 服务器重启或者宕机不会造成Session丢失
        
        - 扩展能⼒强
        
        - 适合⼤集群数量使⽤
    
    - 缺点：
    
        - 对应⽤有⼊侵，引⼊了和Redis的交互代码